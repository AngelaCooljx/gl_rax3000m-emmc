From b797ed6e211c01920ffc37496995e60d35c66f2b Mon Sep 17 00:00:00 2001
From: Jianhui Zhao <jianhui.zhao@gl-inet.com>
Date: Wed, 28 Jun 2023 18:19:13 +0800
Subject: [PATCH] hostapd: support del all clients via ubus

Signed-off-by: Jianhui Zhao <jianhui.zhao@gl-inet.com>
---
 ...00-ubus-del-client-support-broadcast-addr.patch | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 package/network/services/hostapd/patches/800-ubus-del-client-support-broadcast-addr.patch

diff --git a/package/network/services/hostapd/patches/800-ubus-del-client-support-broadcast-addr.patch b/package/network/services/hostapd/patches/800-ubus-del-client-support-broadcast-addr.patch
new file mode 100644
index 0000000000..0313e86719
--- /dev/null
+++ b/package/network/services/hostapd/patches/800-ubus-del-client-support-broadcast-addr.patch
@@ -0,0 +1,14 @@
+--- a/src/ap/ubus.c
++++ b/src/ap/ubus.c
+@@ -563,6 +563,11 @@ hostapd_bss_del_client(struct ubus_conte
+ 			hostapd_drv_sta_disassoc(hapd, addr, reason);
+ 			ap_sta_disassociate(hapd, sta, reason);
+ 		}
++	} else if (is_broadcast_ether_addr(addr)) {
++		if (deauth)
++			 hostapd_drv_sta_deauth(hapd, addr, reason);
++		else
++			hostapd_drv_sta_disassoc(hapd, addr, reason);
+ 	}
+ 
+ 	if (tb[DEL_CLIENT_BAN_TIME])
-- 
2.34.1

